#!groovy

def gitInfo = {}

pipeline {
  agent {
    label 'built-in'
   }
  options {
    skipDefaultCheckout()
   }
  
  stages {
     stage('Git checkout') {
       steps {
         script {

           gitinfo = checkout([$class: 'GitSCM', branches: [[name: '${GIT_BRANCH_NAME}']], doGenerateSubmoduleConfigurations: false, extensions: [], gittool: 'Default', submoduleCfg: [], userRemoteConfigs: [[url: 'https://github.com/vivekcyber/Test4MAS_Nginx.git']]])
           echo "gitInfo: $gitInfo"
          }
       }
     }
     
     stage ('Download Package from Artifactory') {
       steps {
        script {
            echo "This is a test job, no artifactory installed"
               }
             }
         }

     stage ('Deploy package') {
       steps {
        script {
            sh '''
            cd ${WORKSPACE}/Nginx_K8s_Yaml
            cp /tmp/kubeconfig.conf .
            export KUBECONFIG=${WORKSPACE}/Nginx_K8s_Yaml/kubeconfig.conf
            kubectl apply -f namespace.yaml
            kubectl apply -f deployment.yaml
            kubectl apply -f service.yaml
         '''
            }
         }
      }
    
   }

     post { 
        always { 
            cleanWs()
        }
    }
}

